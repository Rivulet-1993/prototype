type: imagenet
version: 0.1
config:
    model:
        type: HRNet
        kwargs:
            stages:
                STAGE1:
                    NUM_MODULES: 1
                    NUM_RANCHES: 1
                    BLOCK: BOTTLENECK
                    NUM_BLOCKS:
                    - 4
                    NUM_CHANNELS:
                    - 64
                    FUSE_METHOD: SUM

                STAGE2:
                    NUM_MODULES: 1
                    NUM_BRANCHES: 2
                    BLOCK: BASIC
                    NUM_BLOCKS:
                    - 4
                    - 4
                    NUM_CHANNELS:
                    - 18
                    - 36
                    FUSE_METHOD: SUM

                STAGE3:
                    NUM_MODULES: 4
                    NUM_BRANCHES: 3
                    BLOCK: BASIC
                    NUM_BLOCKS:
                    - 4
                    - 4
                    - 4
                    NUM_CHANNELS:
                    - 18
                    - 36
                    - 72
                    FUSE_METHOD: SUM
                
                STAGE4:
                    NUM_MODULES: 3
                    NUM_BRANCHES: 4
                    BLOCK: BASIC
                    NUM_BLOCKS:
                    - 4
                    - 4
                    - 4
                    - 4
                    NUM_CHANNELS:
                    - 18
                    - 36
                    - 72
                    - 144
                    FUSE_METHOD: SUM      
            bn:
                use_sync_bn: False
                kwargs: {}

    dist:
        sync: False

    optimizer:
        type: SGD
        kwargs:
            nesterov: True
            momentum: 0.9
            weight_decay: 0.0001

    lr_scheduler:
        type: Step
        kwargs:
            lr_steps: [37500, 75000, 112500]
            lr_mults: [0.1, 0.1, 0.1]

            base_lr: 0.1
            warmup_lr: 0.4
            warmup_steps: 2500
            max_iter: 125000

    label_smooth: 0.1
    ema:
        enable: False

    data:
        use_dali: False
        use_dali_v2: True
        read_from: mc
        batch_size: 64
        dali_workers: 4
        workers: 2
        pin_memory: True
        epoch_wise_shuffle: False

        input_size: 224
        test_resize: 256
        augmentation:
            colorjitter: [0.2, 0.2, 0.2, 0.1]
        train_root: /mnt/lustre/share/images/train
        train_meta: /mnt/lustre/share/images/meta/train.txt
        val_root: /mnt/lustre/share/images/val
        val_meta: /mnt/lustre/share/images/meta/val.txt

    print_freq: 10
    val_freq: 1000
    save_many: False
